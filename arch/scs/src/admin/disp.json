{
	"proto": {
		"uis": {
			"admin_signin": {
				"elements": {
					"sf": {
						"type": "form",
						"fields": {
							"email": {
								"type": "input",
								"inputtype": "email"
							},
							"password": {
								"type": "input",
								"inputtype": "password"
							},
							"submit": {
								"text": "登陆",
								"type": "button",
								"style": "success",
								"onclick": "submit"
							}
						}
					}
				},
				"methods": {
					"submit": {
						"steps": [{
							"type": "req",
							"method": "postBearer",
							"url": "/api/admin_signin",
							"data": "sf.data"
						}]
					}
				}
			}
		},
		"schemas": {
			"adminquery": {
				"fields": {
					"adminin": {
						"type": "ObjectId"
					}
				}
			},
			"adminstat": {
				"fields": {
					"adminin": {
						"type": "ObjectId"
					}
				}
			},			
			"admin": {
				"seed": [
					{
						"email": "test",
						"password": "test",
						"token": "abcdef"
					}
				],
				"fields": {
					"email": {
						"type": "string",
						"text": "邮箱"
					},
					"password": {
						"encrypt": "bcrypt",
						"hidden": true
					},
					"token": {
						"type": "string",
						"hidden": true
					},
					"realname": {
            "text": "真实姓名",
            "type": "string",
            "basic": true
          },
					"modifytime": {
						"type": "datetime",
						"onmodify": true
					},
					"flags": {
						"type": "json"
					},
					"createtime": {
						"type": "datetime", 
						"default": 0 
					}
				}
			}
		},
		"apis": {
			"access": {
				"text": "获取数据库信息",
				"params": {
					"schema": {
						"isParams": true,
						"require": true
					},
					"method": {	
						"isParams": true,
						"require": true
					},
					"where": {
					},
					"options": {
					}
				},				
				"controllers": [
					{
						"type": "async",
						"method": "db.getModel(schema)[method]",
						"params": "where, options",
						"send": "result"
					}
				]
			},
			"export": {
				"text": "导出表格",
				"params": {
					"schema": {
						"isParams": true,
						"require": true
					},
					"method": {	
						"isParams": true,
						"require": true
					},
					"where": {
					},
					"options": {
					}
				}
			},
			"admin_save_querys": {
				"params": {
					"schema": {						
					},
					"data": {
					},
					"_id": {
					}
				},
				"controllers": [
					{
						
					}
				]
			},
			"admin_get_querys": {
				"params": {
					"schema": {
					}
				},
				"controllers": [
					{
						"type": "db",
						"schema": "admin",
						"method": "bselect",
						"where": "{adminid: req.user._id, schema: schema}",
						"send": "{data: result}"
					}
				],
				"midwares": ["auth"]
			},
			"admin_signin": {
				"text": "管理员登陆",
				"params": {
					"email": {
						"type": "string",
						"text": "邮箱",
						"required": true
					},
					"password": {
						"type": "string",
						"text": "密码",
						"required": true
					}
				},
				"controllers": [
					{
						"type": "db",
						"method": "select",
						"schema": "admin",
						"where": "{email: email}",
						"result": "user",
						"check": {
							"!user": "用户名不存在",
							"!libEncrypt.bcryptcompare(password, user.password)": "密码错误"
						}						
					},
					{
						"pre": "token = libRandom.hat();",
						"type": "db",
						"method": "update",
						"schema": "admin",
						"where": "{_id: user._id}",
						"set": "{token: token}",
						"send": "{success: true}"
					}
				]
			},
			"admin_get": {
				"text": "获取管理员信息",
				"midwares": ["auth"]
			}
		}
	},
	"impl": {
		"databases":{
			"main": {
				"withSchemas": [
					"admin",
					"adminstat",
					"adminquery"
				]
			}
		}
	}
}
