^^local.makequery = function(config){$$
	<div class="row">
		<div class="col-sm-8">
		</div>
		<div class="col-sm-4 text-right">
			<div class="btn-group" role="group">
				<button type="button" class="btn btn-default" ng-click="showquery=!showquery"><i class="fa fa-search"></i></button>
				<button type="button" class="btn btn-default" ng-click="showstat=!showstat"><i class="fa fa-search"></i></button>
				<button type="button" class="btn btn-default" ng-click="showadd=!showadd"><i class="fa fa-plus"></i></button>
			</div>
		</div>
		<div class="col-sm-6" ng-show="showquery" style="padding: 10px;">
			<button type="button" class="btn btn-default">添加用户字段</button>
			<button type="button" class="btn btn-default" ng-click="^^=config.name$$.addRawQuery()">添加字段</button>
			<div class="form-group" ng-repeat="rawquery in ^^=config.name$$.rawquerys">
				<div class="input-group" style="padding: 5px 10px;">
					<select class="form-control" ng-model="rawquery.field" ng-options="key for key in ^^=config.name$$.fieldlist"></select>
					<div class="input-group-addon" contenteditable ng-model="rawquery.op" autocomplete="^^=config.name$$.oplist"></div>	
					<input type="text" class="form-control" placeholder="value" ng-model="rawquery.value">
				</div>
			</div>
			<button type="button" class="btn btn-default" ng-click="^^=config.name$$.refresh()">Go!</button>
		</div>
	</div>
^^}$$
^^local.table = function(config){$$
^^
if(config.withSchema){
	if (config.withSchema) {
		if(Object.keys(config.fields).length){
			for(var f in config.fields){
				$.append(config.fields[f], global.proto.schemas[config.withSchema].fields[f]);
			}
		}else{
			$.append(config.fields, global.proto.schemas[config.withSchema].fields);
		}
	}
}
$$
<div class="panel panel-primary">
<div class="panel-heading">^^=config.text || config.name$$</div>
<div class="panel-body">
<div class="col-sm-9">
^^local.makequery(config)$$
</div>
<div class="col-sm-3">
<div class="input-group">
  <input type="text" class="form-control" placeholder="page" ng-model="pageToGo">
  <span class="input-group-btn">
    <button class="btn btn-default" type="button" ng-click="^^=config.name$$.gotoPage(pageToGo)">Go!</button>
  </span>
</div>
<div class="col-sm-9">
</div>
</div>
<div class="col-sm-12 btn-group">
^^if(config.opt && config.opt.add){$$
  <button class="btn btn-default" ng-click="optAdd()">添加数据</button>
^^}$$
^^if(config.toolbar){
  for(var name in config.toolbar){
    var ele = config.toolbar[name];
    if(!ele.tag)ele.tag="button";
  $$<^^=ele.tag$$^^if(ele.attr){if(!ele.attr.class){$$ class="btn btn-default"^^}for(var attrname in ele.attr){$$^^= attrname$$="^^=ele.attr[attrname]$$"^^}}else{$$ class="btn btn-default"^^}$$>^^=ele.text||name$$</^^=ele.tag$$>^^}}$$
</div>

<div class="col-sm-6">
	<div class="form-inline" style="verical-align:middle;padding:0.2em 0;">
	<label style="font-weight:normal">Show <select class="form-control input-sm" ng-model="^^=config.name$$.perPage" ng-options="op for op in ^^=config.name$$.perPages"></select> entries</label>
	</div>
</div>
<div class="col-sm-6 text-right">
	^^pagenator(config)$$
</div>
  <div class="col-sm-12" style="overflow-x:auto;">
  <table class="table table-striped table-bordered" style="vertical-align:middle;"><thead>
 ^^for(var name in config.fields){var col = config.fields[name];$$
 ^^if(!col.hidden){$$
  <th><a style="padding: 0 5px;" ng-click="^^=config.name$$.changeSort('^^=name$$')"><i class="fa" ng-class="{'fa-sort-asc':^^=config.name$$.sort.^^=name$$ === 1,'fa-sort-desc': ^^=config.name$$.sort.^^=name$$ === -1,'fa-sort':!^^=config.name$$.sort.^^=name$$}"></i></a>^^=col.text||name$$<br/>^^=name$$</th>
 ^^}}$$
 ^^if(config.opt){$$
  <th>opt</th>
  ^^}$$
  </thead>
  <tbody>
    <tr ng-repeat="row in ^^=config.name$$.data" onlastrepeat>
 ^^for(var name in config.fields){var col = config.fields[name];$$
 ^^if(!col.hidden){$$
 	<td>
  ^^if(col.ondemand){$$
	<span class="glyphicon glyphicon-option-horizontal" ng-click="^^=config.name$$.showrow^^=name$$=true" ng-hide="^^=config.name$$.showrow^^=name$$"></span>
	<div ng-click="^^=config.name$$.showrow^^=name$$=false" ng-show="^^=config.name$$.showrow^^=name$$">^^bytype(col.type)$$</div>
  ^^}else if(col.href){$$
  <a ng-href="^^=col.href$${{row.^^=name$$}}">^^bytype(col.type)$$</a>
  ^^}else if(col.showuser){$$
  <a data-toggle="popover" class='showuser' data-container="body" data-placement="right" data-content="..." userid="{{row.^^=col.showuser$$}}">^^bytype(col.type)$$</a>
  ^^}else{
		bytype(col.type)
  }$$</td>
 ^^}}$$
 ^^if(config.opt){$$
 <td>
    ^^if(config.opt.update){$$
      <button class="btn btn-primary" ng-click="optUpdate(row)">修改</button>
    ^^}$$
    ^^if(config.opt.delete){$$
      <button class="btn btn-primary" ng-click="optDelete(row)">删除</button>
    ^^}$$
    ^^for(var name in config.opt){if(name != "add" && name != "update" && name != "delete"){$$
      <button class="btn btn-primary"
      ^^for(var attr in config.opt[name].attr){var value = config.opt[name].attr[attr];$$
        ^^=attr$$="^^=value$$" 
        ^^}$$
        >^^= config.opt[name].text || name$$</button>
    ^^}}$$
  </td>
  ^^}$$
		</tr>
	</tbody>
</table>
  </div>
<div class="col-sm-6"><div style="padding:0.5em 0;">Showing {{^^=config.name$$.perPage*(^^=config.name$$.currPage-1)+1}} to {{^^=config.name$$.perPage*^^=config.name$$.currPage}} of {{^^=config.name$$.count}} entries</div></div>
<div class="col-sm-6 text-right">
	^^pagenator(config)$$
</div>
</div>
</div>


 ^^function bytype(type){$$
	^^if(type == "date"){$$
 			{{row.^^=name$$ | stddate}}
	^^}else if(type == "datetime"){$$
 			{{row.^^=name$$|date:'yy/MM/dd HH:mm'}}
  ^^}else{$$
 			{{row.^^=name$$}}
  ^^}$$
 ^^}$$

 ^^function pagenator(config){$$
<ul class="pagination" style="margin:2px 0;">
  <li><a ng-click="^^=config.name$$.gotoFirst()" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
  <li ng-class="{active: p===^^=config.name$$.currPage}" ng-repeat="p in ^^=config.name$$.adj()"><a style="cursor:pointer;" ng-click="^^=config.name$$.gotoPage(p)">{{p}}</a></li>
  <li><a ng-click="^^=config.name$$.gotoLast()" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>
</ul>
</div
 ^^}$$

^^}$$



