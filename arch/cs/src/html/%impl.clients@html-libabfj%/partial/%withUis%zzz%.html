
^^origin.form = function(config){$$

^^}$$


^^origin.format = function(config){
$$
<div class="json">
<ul class="list-group">
^^format(config.model, config.format, "parent")$$
</ul>
</div>
^^
};
function addIndent(level){
 for(var l=0; l<level; l ++){
$$
<span class="indent"></span>
^^
 }
}
function format(model, formatJson, pkey, level){
 var parent = model.replace(/(\.[^\.\[\]]+)$|(\[[^\.\[\]]+\])$/, "");
 if(!level) level = 0;
 if(typeof formatJson != "object"){
    formatJson = {
      $type: typeof formatJson,
      $default: formatJson
    }
 }

 if(formatJson.$type){
	formatSub(model, pkey, formatJson.$type, formatJson, level)
  return;
 }

 if(formatJson.$list){
$$
<div ng-hide="^^=parent$$.$collapse">
<li class="list-group-item">
^^addIndent(level)$$
<span class="icon glyphicon glyphicon-minus" ng-click="^^=model$$.$collapse=!^^=model$$.$collapse"></span>
<div style="display:inline-block;">^^=pkey$$</div>
</li>
<div ng-repeat="(key, val) in ^^=model$$" ng-hide="^^=model$$.$collapse">
^^
		format(model+"[key]", formatJson.$list, "{{key}}", level + 1);
$$
</div>
</div>
^^
  return;
 }
 var ii=0;
 for(var key in formatJson){
  if(key[0] == "$") continue;
  ii ++;
 }
$$
<li class="list-group-item" ng-hide="^^=parent$$.$collapse">
^^addIndent(level)$$
<span class="icon glyphicon glyphicon-minus" ng-click="^^=model$$.$collapse=!^^=model$$.$collapse"></span>
<div style="display:inline-block;">^^=pkey$$</div>
</li>
^^
 for(var key in formatJson){
  if(key[0] == "$") continue;
  var f = formatJson[key];
  if(f.$multi){

  }else{
	 formatSub(model+"['"+key + "']", key, f.$type, f, level + 1)
  }
 }
}
$$

^^function formatSub(model, key, type, f, level){
 var parent = model.replace(/(\.[^\.\[\]]+)$|(\[[^\.\[\]]+\])$/, "");
 var defaultStr = "";

 if(f.$default) defaultStr='default="'+f.$default + '"';
$$
^^
 if(type == "number" || type == "string" || type == "boolean"){
$$

<li class="list-group-item" ng-hide="^^=parent$$.$collapse">
^^addIndent(level)$$
<span class="icon glyphicon glyphicon-wrench"></span>
<div style="display:inline-block;font-weight:700;margin-right:1em;">^^=key$$</div>
<div style="display:inline-block;min-width:3em;" ng-model="^^=model$$" contenteditable ^^=defaultStr$$></div>
</li>
^^
 }else{
format(model, f, key, level)
 }
}
$$

^^origin.list = list;
function list(config){
var itemStr = "item";
var styleStr = "";
var clickStr = "";
if(config.click){
 clickStr='ng-click="'+config.click+'"'
 styleStr+="cursor:pointer;";
}
if(!$.isArray(config))
 itemStr = "(name, item)";
$$
<ul class="list-group">
  <li class="list-group-item" ng-repeat="^^=itemStr$$ in ^^=config.model$$" ^^=clickStr$$ style="^^=styleStr$$">^^=config.content || '{{item.name}}'$$</li>
</ul>
^^}$$

^^origin.table = function(config){$$
<div class="panel panel-primary">
<div class="panel-heading">^^=config.text || config.name$$</div>
<div class="panel-body">
<!--
	<div class="col-sm-8">
		<div class="col-sm-12" style="border:1px solid #428bca;border-radius:4px;margin:12px;padding:5px;">
			<div class="row">
				<div class="col-sm-8">
					<div class="btn-group" role="group">
						<a type="button" class="btn btn-default" ng-repeat="query in ^^=config.name$$.querys">{{query.name}}</a>
					</div>
				</div>
				<div class="col-sm-4 text-right">
					<div class="btn-group" role="group">
						<button type="button" class="btn btn-default" ng-click="edit=!edit"><i class="fa fa-plus"></i></button>
					</div>
				</div>
				<div class="col-sm-6" ng-show="edit" style="padding: 10px;">
					<div class="form-group">
						<div class="input-group" style="padding: 5px 10px;">
							<input type="text" class="form-control" id="exampleInputAmount" placeholder="Amount">
							<div class="input-group-addon" contenteditable ng-model="xxx" autocomplete="aaa" default="aaax"></div>			
							<input type="text" class="form-control" id="exampleInputAmount" placeholder="Amount">
						</div>
						<div class="input-group">
							<input type="text" class="form-control" id="exampleInputAmount" placeholder="Amount">
							<div class="input-group-addon" contenteditable ng-model="xxxx" autocomplete="aaa" default="aaax"></div>
							<input type="text" class="form-control" contenteditable autocomplete="aaa" id="exampleInputAmount" placeholder="Amount" default="xxx" ng-model="xxxx">
						</div>
					</div>
				</div>
			</div>
	</div>
</div>
-->
<br/>
<div class="col-sm-5">
	<div class="form-inline" style="verical-align:middle;padding:0.2em 0;">
	<label style="font-weight:normal">Show <select class="form-control input-sm" ng-model="^^=config.name$$.perPage">
			<option value="10">10</option>
			<option value="25">25</option>
			<option value="50">50</option>
			<option value="100">100</option>
		</select> entries</label>
	</div>
</div>
<div class="col-sm-7 text-right">
	^^pagenator(config)$$
</div>

<table class="table table-striped table-bordered" style="vertical-align:middle;">
^^
if(config.withSchema){
 $.append(config.fields, global.proto.schemas[config.withSchema].fields);
}
$$
 ^^for(var name in config.fields){var col = config.fields[name];$$
  <th><a style="padding: 0 5px;" ng-click="^^=config.name$$.changeSort('^^=name$$')"><i class="fa" ng-class="{'fa-sort-asc':^^=config.name$$.sort.^^=name$$ === 1,'fa-sort-desc': ^^=config.name$$.sort.^^=name$$ === -1,'fa-sort':!^^=config.name$$.sort.^^=name$$}"></i></a>^^=col.text||name$$<br/>^^=name$$</th>
 ^^}$$
  </thead>
  <tbody>
    <tr ng-repeat="row in ^^=config.name$$.data">
 ^^for(var name in config.fields){var col = config.fields[name];$$
 			<td>
  ^^if(col.ondemand){$$
		<span class="glyphicon glyphicon-option-horizontal" ng-click=""></span>
  ^^}else{
		bytype(col.type)
  }$$</td>
 ^^}$$
		</tr>
	</tbody>
</table>
<div class="col-sm-5"><div style="padding:0.5em 0;">Showing {{^^=config.name$$.perPage*(^^=config.name$$.currPage-1)+1}} to {{^^=config.name$$.perPage*^^=config.name$$.currPage}} of {{^^=config.name$$.count}} entries</div></div>
<div class="col-sm-7 text-right">
	^^pagenator(config)$$
</div>
</div>
</div>

 ^^function bytype(type){$$
	^^if(type == "date"){$$
 			{{row.^^=name$$|date:'yyyyMMdd'}}
	^^}else if(type == "datetime"){$$
 			{{row.^^=name$$|date:'yyMMdd HH:mm'}}
  ^^}else{$$
 			{{row.^^=name$$}}
  ^^}$$
 ^^}$$

 ^^function pagenator(config){$$
<ul class="pagination" style="margin:2px 0;">
  <li><a ng-click="^^=config.name$$.gotoFirst()" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
  <li ng-class="{active: p===^^=config.name$$.currPage}" ng-repeat="p in ^^=config.name$$.adj()"><a style="cursor:pointer;" ng-click="^^=config.name$$.gotoPage(p)">{{p}}</a></li>
  <li><a ng-click="^^=config.name$$.gotoLast()" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>
</ul>
 ^^}$$

^^}$$
^^origin.summaryTable = function(config){$$

^^}$$
^^origin.editTable = function(config){$$

^^}$$



^^function genKit(config, model){
 if(config.kit == "list"){	
  list({model: model})
 }else if(config.kit == "mono"){
  mono({model: model, format: config.format})
 }
}$$
^^function genFormat(config){$$
^^}$$


^^origin.leadPanel = function(config){$$
<div class="panel panel-primary">
  <div class="panel-heading">
    <div class="row">
      <div class="col-xs-3">
        <i class="fa fa-comments fa-5x"></i>
      </div>
      <div class="col-xs-9 text-right">
        <div class="huge">26</div>
        <div>New Comments!</div>
      </div>
    </div>
  </div>
  <a href="#">
    <div class="panel-footer">
      <span class="pull-left">View Details</span>
      <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
      <div class="clearfix"></div>
    </div>
  </a>
</div>
^^}$$
